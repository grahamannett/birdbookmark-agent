FROM oven/bun:latest

WORKDIR /app

# Install bird CLI for fetching bookmarks
RUN apt-get update && apt-get install -y npm curl && \
    npm install -g @steipete/bird && \
    apt-get clean && rm -rf /var/lib/apt/lists/*

# Copy source files
COPY src/ ./src/
COPY scripts/ ./scripts/

# Install dependencies including AWS Bedrock SDK
RUN bun add @anthropic-ai/bedrock-sdk zod youtube-transcript @extractus/article-extractor

# Create data directory for state
RUN mkdir -p /app/data

# Default environment variables
ENV NODE_ENV=production
ENV STATE_PATH=/app/data/processed.json

# Run the processor
ENTRYPOINT ["bun", "scripts/process-bookmarks.ts"]
CMD []
